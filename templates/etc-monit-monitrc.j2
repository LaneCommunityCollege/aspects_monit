###############################################################################
## Monit control file
## {{ ansible_managed }}
###############################################################################
##
## Comments begin with a '#' and extend through the end of the line. Keywords
## are case insensitive. All path's MUST BE FULLY QUALIFIED, starting with '/'.
##
## Below you will find examples of some frequently used statements. For 
## information about the control file and a complete list of statements and 
## options, please have a look in the Monit manual.
##
##
###############################################################################
## Global section
###############################################################################
##
## Start Monit in the background (run as a daemon):
#
  set daemon {{ aspects_monit_check_interval }}
  {% if aspects_monit_start_delay is defined %}
   with start delay {{ aspects_monit_start_delay }}
  {% endif %}
#   with start delay 240    # optional: delay the first check by 4-minutes (by 
#                           # default Monit check immediately after Monit start)
#
#
## Set syslog logging with the 'daemon' facility. If the FACILITY option is
## omitted, Monit will use 'user' facility by default. If you want to log to 
## a standalone log file instead, specify the full path to the log file
#
# set logfile syslog facility log_daemon                       
  {% if aspects_monit_logfile is defined %}
  set logfile {{ aspects_monit_logfile }}
  {% else %}
  set logfile /var/log/monit.log
  {% endif %}
#
#
## Set the location of the Monit id file which stores the unique id for the
## Monit instance. The id is generated and stored on first Monit start. By 
## default the file is placed in $HOME/.monit.id.
#
# set idfile /var/.monit.id
 {% if aspects_monit_idfile is defined %}
 set idfile {{ aspects_monit_idfile }}
 {% else %}
 set idfile /opt/monit/id/.monit.id
 {% endif %}
  
#
## Set the location of the Monit state file which saves monitoring states
## on each cycle. By default the file is placed in $HOME/.monit.state. If
## the state file is stored on a persistent filesystem, Monit will recover
## the monitoring state across reboots. If it is on temporary filesystem, the
## state will be lost on reboot which may be convenient in some situations.
#
 {% if aspects_monit_statefile is defined %}
 set statefile {{ aspects_monit_statefile }}
 {% else %}
 set statefile /opt/monit/state/.monit.state
 {% endif %}
  
#
## Set the list of mail servers for alert delivery. Multiple servers may be 
## specified using a comma separator. If the first mail server fails, Monit 
# will use the second mail server in the list and so on. By default Monit uses 
# port 25 - it is possible to override this with the PORT option.
#
# set mailserver mail.bar.baz,               # primary mailserver
#                backup.bar.baz port 10025,  # backup mailserver on port 10025
#                localhost                   # fallback relay
 {% if aspects_monit_mailserver is defined %}
 set mailserver {{ aspects_monit_mailserver }}
 {% else %}
 set mailserver localhost
 {% endif %}

#
#
## By default Monit will drop alert events if no mail servers are available. 
## If you want to keep the alerts for later delivery retry, you can use the 
## EVENTQUEUE statement. The base directory where undelivered alerts will be 
## stored is specified by the BASEDIR option. You can limit the maximal queue
## size using the SLOTS option (if omitted, the queue is limited by space 
## available in the back end filesystem).
#
 {% if aspects_monit_eventqueue is defined %}
  set eventqueue {{ aspects_monit_eventqueue }}
 {% else %}
 set eventqueue basedir /opt/monit/events slots 100
 {% endif %}
  
#
#
## Send status and events to M/Monit (for more informations about M/Monit 
## see http://mmonit.com/). By default Monit registers credentials with 
## M/Monit so M/Monit can smoothly communicate back to Monit and you don't
## have to register Monit credentials manually in M/Monit. It is possible to
## disable credential registration using the commented out option below. 
## Though, if safety is a concern we recommend instead using https when
## communicating with M/Monit and send credentials encrypted.
#
 {% if aspects_monit_mmonit is defined %}
 {{ aspects_monit_mmonit }}
 {% endif %}
# set mmonit http://monit:monit@192.168.1.10:8080/collector
#     # and register without credentials     # Don't register credentials
#
#
## Monit by default uses the following format for alerts if the the mail-format
## statement is missing::
## --8<--
## set mail-format {
##      from: monit@$HOST
##   subject: monit alert --  $EVENT $SERVICE
##   message: $EVENT Service $SERVICE
##                 Date:        $DATE
##                 Action:      $ACTION
##                 Host:        $HOST
##                 Description: $DESCRIPTION
##
##            Your faithful employee,
##            Monit
## }
## --8<--
##
## You can override this message format or parts of it, such as subject
## or sender using the MAIL-FORMAT statement. Macros such as $DATE, etc.
## are expanded at runtime. For example, to override the sender, use:
#
# set mail-format { from: monit@foo.bar }
{% if aspects_monit_mail_format is defined %}
 {{ aspects_monit_mail_format }}
 {% endif %}
#
#
## You can set alert recipients whom will receive alerts if/when a 
## service defined in this file has errors. Alerts may be restricted on 
## events by using a filter as in the second example below. 
#
 {% if aspects_monit_alert_recipients is defined %}
 {% for item in aspects_monit_alert_recipients %}
 set alert {{ aspects_monit_alert_recipients[item] }}
 {% endfor %}
 {% endif %}
 #set alert blah@blah.bla                       # receive all alerts
# set alert manager@foo.bar only on { timeout }  # receive just service-
#                                                # timeout alert
#
#
## Monit has an embedded web server which can be used to view status of 
## services monitored and manage services from a web interface. See the
## Monit Wiki if you want to enable SSL for the web server. 
#
# set httpd port 2812 and
#    use address localhost  # only accept connection from localhost
#    allow localhost        # allow localhost to connect to the server and
#    allow admin:monit      # require user 'admin' with password 'monit'
#    allow @monit           # allow users of group 'monit' to connect (rw)
#    allow @users readonly  # allow users of group 'users' to connect readonly
 {% if aspects_monit_web_server is defined %}
 {{ aspects_monit_web_server }}
 {% endif %}


{% if aspects_monit_remote_probes is defined %}
## Ansible generated probes aimed at remote servers.
{% for remoteprobe in aspects_monit_remote_probes %}
{{ aspects_monit_remote_probes[remoteprobe] }}
{% endfor %}
{% endif %}


{% if aspects_monit_local_probes is defined %}
## Ansible generated probes local to this server.
{% for localprobe in aspects_monit_local_probes %}
{{ aspects_monit_local_probes[localprobe] }}
{% endfor %}
{% endif %}

{% if ansible_os_family == "RedHat" and aspects_monit_local_probes_RedHat is defined %}
{% for localprobe in aspects_monit_local_probes_RedHat %}
{{ aspects_monit_local_probes_RedHat[localprobe] }}
{% endfor %}
{% endif %}

{% if ansible_os_family == "Debian" and aspects_monit_local_probes_Debian is defined %}
{% for localprobe in aspects_monit_local_probes_Debian %}
{{ aspects_monit_local_probes_Debian[localprobe] }}
{% endfor %}
{% endif %}

{% if ansible_os_family == "Suse" and aspects_monit_local_probes_Suse is defined %}
{% for localprobe in aspects_monit_local_probes_Suse %}
{{ aspects_monit_local_probes_Suse[localprobe] }}
{% endfor %}
{% endif %}

   include /opt/monit/conf.d/*

