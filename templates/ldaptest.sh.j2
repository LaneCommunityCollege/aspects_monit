#!/bin/bash
# This script relies on the existence of ldapsearch
#{{ ansible_managed }}
{% if item.value.ldapsearchexe is defined %}
LDAPSEARCHEXE={{ item.value.ldapsearchexe }}
{% endif %}
{% if item.value.host is defined %}
HOST={{ item.value.host }}
{% endif %}
{% if item.value.binddn is defined %}
BINDDN={{ item.value.binddn }}
{% endif %}
{% if item.value.password is defined %}
PASSWORD={{ item.value.password }}
{% endif %}
{% if item.value.port is defined %}
#PORT={{ item.value.port }}
{% endif %}
{% if item.value.base is defined %}
#BASE={{ item.value.base }}
{% endif %}
{% if item.value.filter is defined %}
FILTER={{ item.value.filter }}
{% endif %}
{% if item.value.version is defined %}
VERSION={{ item.value.version }}
{% endif %}
{% if item.value.attributes is defined %}
ATTRIBUTES={{ item.value.attributes }}
{% endif %}

ldapsearch -x -D $BINDDN -w $PASSWORD -H $HOST -P $VERSION "$FILTER" $ATTRIBUTES